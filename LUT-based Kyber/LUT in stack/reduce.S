
/*
 * reduce.S
 *
 * Created: 2023-03-18 오후 3:41:25
 */ 

 #include "LUT_butterfly.i"
 #include "common.i"

 .section .data
.global	LUT1_H
.type	LUT1_H, @object

.balign 256
LUT1_H : .byte	0x00, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01, 0xFD,\
				0x06, 0x02, 0xFE, 0xFA, 0x03, 0xFF, 0xFA, 0x03,\
				0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01, 0xFD,\
				0x06, 0x02, 0xFE, 0xF9, 0x02, 0xFE, 0xFA, 0x03,\
				0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01, 0xFD,\
				0x05, 0x01, 0xFD, 0xF9, 0x02, 0xFE, 0xFA, 0x03,\
				0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x04, 0x00, 0xFC,\
				0x05, 0x01, 0xFD, 0x06, 0x02, 0xFE, 0xFA, 0x03,\
				0xFF, 0xFB, 0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC,\
				0x05, 0x01, 0xFD, 0x06, 0x02, 0xFE, 0xFA, 0x02,\
				0xFE, 0xFA, 0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC,\
				0x05, 0x01, 0xFD, 0x06, 0x01, 0xFD, 0xF9, 0x02,\
				0xFE, 0xFA, 0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC,\
				0x05, 0x00, 0xFC, 0x05, 0x01, 0xFD, 0xF9, 0x02,\
				0xFE, 0xFA, 0x03, 0xFF, 0xFB, 0x04, 0xFF, 0xFB,\
				0x04, 0x00, 0xFC, 0x05, 0x01, 0xFD, 0x06, 0x02,\
				0xFE, 0xFA, 0x03, 0xFE, 0xFA, 0x03, 0xFF, 0xFB,\
				0x04, 0x00, 0xFC, 0x05, 0x01, 0xFD, 0x06, 0x02,\
				0xFD, 0xF9, 0x02, 0xFE, 0xFA, 0x03, 0xFF, 0xFB,\
				0x04, 0x00, 0xFC, 0x05, 0x01, 0xFC, 0x05, 0x01,\
				0xFD, 0xF9, 0x02, 0xFE, 0xFA, 0x03, 0xFF, 0xFB,\
				0x04, 0x00, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01,\
				0xFD, 0x06, 0x02, 0xFE, 0xFA, 0x03, 0xFF, 0xFA,\
				0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01,\
				0xFD, 0x06, 0x02, 0xFE, 0xF9, 0x02, 0xFE, 0xFA,\
				0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x05, 0x01,\
				0xFD, 0x05, 0x01, 0xFD, 0xF9, 0x02, 0xFE, 0xFA,\
				0x03, 0xFF, 0xFB, 0x04, 0x00, 0xFC, 0x04, 0x00,\
				0xFC, 0x05, 0x01, 0xFD, 0x06, 0x02, 0xFE, 0xFA,\
				0x03, 0xFF, 0xFB, 0x03, 0xFF, 0xFB, 0x04, 0x00,\
				0xFC, 0x05, 0x01, 0xFD, 0x06, 0x02, 0xFE, 0xFA,\
				0x02, 0xFE, 0xFA, 0x03, 0xFF, 0xFB, 0x04, 0x00

.global	LUT1_L
.type	LUT1_L, @object

.balign 256
LUT1_L : .byte	0x00, 0xEC, 0xD9, 0xC5, 0xB1, 0x9E, 0x8A, 0x76,\
				0x63, 0x4F, 0x3B, 0x27, 0x14, 0x00, 0xEC, 0xD9,\
				0xC5, 0xB1, 0x9E, 0x8A, 0x76, 0x63, 0x4F, 0x3B,\
				0x28, 0x14, 0x00, 0xEC, 0xD9, 0xC5, 0xB1, 0x9E,\
				0x8A, 0x76, 0x63, 0x4F, 0x3B, 0x28, 0x14, 0x00,\
				0xED, 0xD9, 0xC5, 0xB1, 0x9E, 0x8A, 0x76, 0x63,\
				0x4F, 0x3B, 0x28, 0x14, 0x00, 0xED, 0xD9, 0xC5,\
				0xB2, 0x9E, 0x8A, 0x77, 0x63, 0x4F, 0x3B, 0x28,\
				0x14, 0x00, 0xED, 0xD9, 0xC5, 0xB2, 0x9E, 0x8A,\
				0x77, 0x63, 0x4F, 0x3C, 0x28, 0x14, 0x00, 0xED,\
				0xD9, 0xC5, 0xB2, 0x9E, 0x8A, 0x77, 0x63, 0x4F,\
				0x3C, 0x28, 0x14, 0x01, 0xED, 0xD9, 0xC5, 0xB2,\
				0x9E, 0x8A, 0x77, 0x63, 0x4F, 0x3C, 0x28, 0x14,\
				0x01, 0xED, 0xD9, 0xC6, 0xB2, 0x9E, 0x8A, 0x77,\
				0x63, 0x4F, 0x3C, 0x28, 0x14, 0x01, 0xED, 0xD9,\
				0xC6, 0xB2, 0x9E, 0x8B, 0x77, 0x63, 0x50, 0x3C,\
				0x28, 0x14, 0x01, 0xED, 0xD9, 0xC6, 0xB2, 0x9E,\
				0x8B, 0x77, 0x63, 0x50, 0x3C, 0x28, 0x15, 0x01,\
				0xED, 0xD9, 0xC6, 0xB2, 0x9E, 0x8B, 0x77, 0x63,\
				0x50, 0x3C, 0x28, 0x15, 0x01, 0xED, 0xDA, 0xC6,\
				0xB2, 0x9E, 0x8B, 0x77, 0x63, 0x50, 0x3C, 0x28,\
				0x15, 0x01, 0xED, 0xDA, 0xC6, 0xB2, 0x9F, 0x8B,\
				0x77, 0x64, 0x50, 0x3C, 0x28, 0x15, 0x01, 0xED,\
				0xDA, 0xC6, 0xB2, 0x9F, 0x8B, 0x77, 0x64, 0x50,\
				0x3C, 0x29, 0x15, 0x01, 0xED, 0xDA, 0xC6, 0xB2,\
				0x9F, 0x8B, 0x77, 0x64, 0x50, 0x3C, 0x29, 0x15,\
				0x01, 0xEE, 0xDA, 0xC6, 0xB2, 0x9F, 0x8B, 0x77,\
				0x64, 0x50, 0x3C, 0x29, 0x15, 0x01, 0xEE, 0xDA,\
				0xC6, 0xB3, 0x9F, 0x8B, 0x78, 0x64, 0x50, 0x3C,\
				0x29, 0x15, 0x01, 0xEE, 0xDA, 0xC6, 0xB3, 0x9F,\
				0x8B, 0x78, 0x64, 0x50, 0x3D, 0x29, 0x15, 0x01,\
				0xEE, 0xDA, 0xC6, 0xB3, 0x9F, 0x8B, 0x78, 0x64


.global	LUT2_H
.type	LUT2_H, @object

.balign 256
LUT2_H : .byte	0x00, 0xFC, 0x05, 0x01, 0xFE, 0xFA, 0x03, 0x00,\
				0x03, 0xFF, 0xFC, 0x05, 0x01, 0xFE, 0xFA, 0x03,\
				0x02, 0xFF, 0xFB, 0x04, 0x01, 0xFD, 0xF9, 0x03,\
				0x06, 0x02, 0xFF, 0xFB, 0x04, 0x01, 0xFD, 0xF9,\
				0x05, 0x02, 0xFE, 0xFA, 0x04, 0x00, 0xFC, 0x06,\
				0xFC, 0x05, 0x02, 0xFE, 0xFA, 0x04, 0x00, 0xFC,\
				0xFB, 0x05, 0x01, 0xFD, 0xFA, 0x03, 0xFF, 0xFC,\
				0xFF, 0xFB, 0x05, 0x01, 0xFD, 0xFA, 0x03, 0xFF,\
				0xFE, 0xFB, 0x04, 0x00, 0xFD, 0xF9, 0x02, 0xFF,\
				0x02, 0xFE, 0xFB, 0x04, 0x00, 0xFD, 0x06, 0x02,\
				0x01, 0xFE, 0xFA, 0x03, 0x00, 0xFC, 0x05, 0x02,\
				0x05, 0x01, 0xFE, 0xFA, 0x03, 0x00, 0xFC, 0x05,\
				0x04, 0x01, 0xFD, 0xF9, 0x03, 0xFF, 0xFB, 0x05,\
				0xFB, 0x04, 0x01, 0xFD, 0xF9, 0x03, 0xFF, 0xFB,\
				0xFA, 0x04, 0x00, 0xFC, 0x06, 0x02, 0xFE, 0xFB,\
				0xFE, 0xFA, 0x04, 0x00, 0xFC, 0x06, 0x02, 0xFE,\
				0xFD, 0xFA, 0x03, 0xFF, 0xFC, 0x05, 0x01, 0xFE,\
				0x01, 0xFD, 0xFA, 0x03, 0xFF, 0xFC, 0x05, 0x01,\
				0x00, 0xFD, 0xF9, 0x02, 0xFF, 0xFB, 0x04, 0x01,\
				0x04, 0x00, 0xFD, 0x06, 0x02, 0xFF, 0xFB, 0x04,\
				0x03, 0x00, 0xFC, 0x05, 0x02, 0xFE, 0xFA, 0x04,\
				0xFA, 0x03, 0x00, 0xFC, 0x05, 0x02, 0xFE, 0xFA,\
				0xF9, 0x03, 0xFF, 0xFB, 0x05, 0x01, 0xFD, 0xFA,\
				0xFD, 0xF9, 0x03, 0xFF, 0xFB, 0x05, 0x01, 0xFD,\
				0xFC, 0x06, 0x02, 0xFE, 0xFB, 0x04, 0x00, 0xFD,\
				0x00, 0xFC, 0x06, 0x02, 0xFE, 0xFB, 0x04, 0x00,\
				0xFF, 0xFC, 0x05, 0x01, 0xFE, 0xFA, 0x03, 0x00,\
				0x03, 0xFF, 0xFC, 0x05, 0x01, 0xFD, 0xFA, 0x03,\
				0x02, 0xFF, 0xFB, 0x04, 0x01, 0xFD, 0xF9, 0x03,\
				0x06, 0x02, 0xFF, 0xFB, 0x04, 0x00, 0xFD, 0xF9,\
				0x05, 0x02, 0xFE, 0xFA, 0x04, 0x00, 0xFC, 0x06,\
				0xFC, 0x05, 0x02, 0xFE, 0xFA, 0x03, 0x00, 0xFC

.global	LUT2_L
.type	LUT2_L, @object

.balign 256
LUT2_L : .byte	0x00, 0x50, 0xA1, 0xF1, 0x41, 0x91, 0xE2, 0x32,\
				0x7E, 0xCE, 0x1E, 0x6F, 0xBF, 0x0F, 0x5F, 0xB0,\
				0xFF, 0x4F, 0x9F, 0xF0, 0x40, 0x90, 0xE0, 0x31,\
				0x7D, 0xCD, 0x1D, 0x6D, 0xBE, 0x0E, 0x5E, 0xAE,\
				0xFE, 0x4E, 0x9E, 0xEE, 0x3F, 0x8F, 0xDF, 0x30,\
				0x7B, 0xCC, 0x1C, 0x6C, 0xBC, 0x0D, 0x5D, 0xAD,\
				0xFC, 0x4D, 0x9D, 0xED, 0x3D, 0x8E, 0xDE, 0x2E,\
				0x7A, 0xCA, 0x1B, 0x6B, 0xBB, 0x0B, 0x5C, 0xAC,\
				0xFB, 0x4B, 0x9C, 0xEC, 0x3C, 0x8C, 0xDD, 0x2D,\
				0x79, 0xC9, 0x19, 0x6A, 0xBA, 0x0A, 0x5B, 0xAB,\
				0xFA, 0x4A, 0x9A, 0xEB, 0x3B, 0x8B, 0xDC, 0x2C,\
				0x78, 0xC8, 0x18, 0x68, 0xB9, 0x09, 0x59, 0xAA,\
				0xF9, 0x49, 0x99, 0xE9, 0x3A, 0x8A, 0xDA, 0x2B,\
				0x76, 0xC7, 0x17, 0x67, 0xB7, 0x08, 0x58, 0xA8,\
				0xF7, 0x48, 0x98, 0xE8, 0x39, 0x89, 0xD9, 0x29,\
				0x75, 0xC5, 0x16, 0x66, 0xB6, 0x07, 0x57, 0xA7,\
				0xF6, 0x46, 0x97, 0xE7, 0x37, 0x88, 0xD8, 0x28,\
				0x74, 0xC4, 0x14, 0x65, 0xB5, 0x05, 0x56, 0xA6,\
				0xF5, 0x45, 0x95, 0xE6, 0x36, 0x86, 0xD7, 0x27,\
				0x73, 0xC3, 0x13, 0x64, 0xB4, 0x04, 0x54, 0xA5,\
				0xF4, 0x44, 0x94, 0xE5, 0x35, 0x85, 0xD5, 0x26,\
				0x71, 0xC2, 0x12, 0x62, 0xB3, 0x03, 0x53, 0xA3,\
				0xF2, 0x43, 0x93, 0xE3, 0x34, 0x84, 0xD4, 0x24,\
				0x70, 0xC0, 0x11, 0x61, 0xB1, 0x02, 0x52, 0xA2,\
				0xF1, 0x42, 0x92, 0xE2, 0x32, 0x83, 0xD3, 0x23,\
				0x6F, 0xBF, 0x10, 0x60, 0xB0, 0x00, 0x51, 0xA1,\
				0xF0, 0x40, 0x91, 0xE1, 0x31, 0x81, 0xD2, 0x22,\
				0x6E, 0xBE, 0x0E, 0x5F, 0xAF, 0xFF, 0x4F, 0xA0,\
				0xEF, 0x3F, 0x8F, 0xE0, 0x30, 0x80, 0xD0, 0x21,\
				0x6D, 0xBD, 0x0D, 0x5D, 0xAE, 0xFE, 0x4E, 0x9E,\
				0xEE, 0x3E, 0x8E, 0xDE, 0x2F, 0x7F, 0xCF, 0x20,\
				0x6B, 0xBC, 0x0C, 0x5C, 0xAC, 0xFD, 0x4D, 0x9D

.global	LUT3_H
.type	LUT3_H, @object

.balign 256
LUT3_H : .byte	0x00, 0x01, 0x02, 0xF5, 0xF6, 0x05, 0x06, 0xF9,\
				0x08, 0x09, 0xFC, 0xFD, 0x0C, 0x0D, 0xF3, 0xF4,\
				0x02, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xFC,\
				0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04,\
				0x05, 0x06, 0x07, 0x08, 0xFC, 0xFD, 0xFE, 0xFF,\
				0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06, 0x07,\
				0x08, 0xFC, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5,\
				0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xFC, 0xFD,\
				0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05,\
				0x06, 0x07, 0x08, 0xFC, 0xFD, 0xFE, 0xFF, 0xF3,\
				0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\
				0xFC, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03,\
				0x04, 0x05, 0x06, 0x07, 0x08, 0xFC, 0xFD, 0xFE,\
				0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06,\
				0x07, 0x08, 0xFC, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4,\
				0xF5, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0xFC,\
				0xF5, 0xF6, 0xF7, 0xF8, 0xF9, 0xFA, 0x08, 0x09,\
				0x0A, 0x0B, 0x0C, 0x00, 0xF4, 0xF5, 0xF6, 0xF7,\
				0x05, 0x06, 0x07, 0x08, 0x09, 0xFD, 0xFE, 0xFF,\
				0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06, 0x07,\
				0x08, 0x09, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5,\
				0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0xFD,\
				0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05,\
				0x06, 0x07, 0x08, 0x09, 0xFD, 0xFE, 0xFF, 0xF3,\
				0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08,\
				0x09, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03,\
				0x04, 0x05, 0x06, 0x07, 0x08, 0x09, 0xFD, 0xFE,\
				0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04, 0x05, 0x06,\
				0x07, 0x08, 0x09, 0xFD, 0xFE, 0xFF, 0xF3, 0xF4,\
				0xF5, 0x03, 0x04, 0x05, 0x06, 0x07, 0x08, 0x09,\
				0xFD, 0xFE, 0xFF, 0xF3, 0xF4, 0xF5, 0x03, 0x04,\
				0x05, 0x06, 0x07, 0x08, 0x09, 0xFD, 0xFE, 0xFF

.global	LUT3_L
.type	LUT3_L, @object

.balign 256
LUT3_L : .byte	0x00, 0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFF,\
				0x00, 0x00, 0xFF, 0xFF, 0x00, 0x00, 0xFE, 0xFE,\
				0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFF, 0xFE,\
				0xFE, 0xFE, 0xFE, 0xFD, 0xFD, 0xFD, 0xFE, 0xFE,\
				0xFE, 0xFE, 0xFE, 0xFE, 0xFD, 0xFD, 0xFD, 0xFD,\
				0xFC, 0xFC, 0xFC, 0xFD, 0xFD, 0xFD, 0xFD, 0xFD,\
				0xFD, 0xFC, 0xFC, 0xFC, 0xFC, 0xFB, 0xFB, 0xFB,\
				0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFC, 0xFB, 0xFB,\
				0xFB, 0xFB, 0xFA, 0xFA, 0xFA, 0xFB, 0xFB, 0xFB,\
				0xFB, 0xFB, 0xFB, 0xFA, 0xFA, 0xFA, 0xFA, 0xF9,\
				0xF9, 0xF9, 0xFA, 0xFA, 0xFA, 0xFA, 0xFA, 0xFA,\
				0xF9, 0xF9, 0xF9, 0xF9, 0xF8, 0xF8, 0xF8, 0xF9,\
				0xF9, 0xF9, 0xF9, 0xF9, 0xF9, 0xF8, 0xF8, 0xF8,\
				0xF8, 0xF7, 0xF7, 0xF7, 0xF8, 0xF8, 0xF8, 0xF8,\
				0xF8, 0xF8, 0xF7, 0xF7, 0xF7, 0xF7, 0xF6, 0xF6,\
				0xF6, 0xF7, 0xF7, 0xF7, 0xF7, 0xF7, 0xF7, 0xF6,\
				0x09, 0x09, 0x09, 0x09, 0x09, 0x09, 0x0A, 0x0A,\
				0x0A, 0x0A, 0x0A, 0x09, 0x08, 0x08, 0x08, 0x08,\
				0x09, 0x09, 0x09, 0x09, 0x09, 0x08, 0x08, 0x08,\
				0x07, 0x07, 0x07, 0x08, 0x08, 0x08, 0x08, 0x08,\
				0x08, 0x08, 0x07, 0x07, 0x07, 0x06, 0x06, 0x06,\
				0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x07, 0x06,\
				0x06, 0x06, 0x05, 0x05, 0x05, 0x06, 0x06, 0x06,\
				0x06, 0x06, 0x06, 0x06, 0x05, 0x05, 0x05, 0x04,\
				0x04, 0x04, 0x05, 0x05, 0x05, 0x05, 0x05, 0x05,\
				0x05, 0x04, 0x04, 0x04, 0x03, 0x03, 0x03, 0x04,\
				0x04, 0x04, 0x04, 0x04, 0x04, 0x04, 0x03, 0x03,\
				0x03, 0x02, 0x02, 0x02, 0x03, 0x03, 0x03, 0x03,\
				0x03, 0x03, 0x03, 0x02, 0x02, 0x02, 0x01, 0x01,\
				0x01, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02, 0x02,\
				0x01, 0x01, 0x01, 0x00, 0x00, 0x00, 0x01, 0x01,\
				0x01, 0x01, 0x01, 0x01, 0x01, 0x00, 0x00, 0x00


.section .text

#define zero	r1
#define	src_l	r24
#define	src_h	r25
#define	t_l		r18

.global	small_LUT_reduce_asm
.type	small_LUT_reduce_asm, @function

small_LUT_reduce_asm : 

	mc_small_LUT_reduce_asm zero, src_l, src_h, t_l

	ret

#undef	zero	
#undef	src_l
#undef	src_h
#undef	t_l

#define	tmp_integer	r19
#define	tmp_h		r20
#define	tmp_l		r21
#define	src_ll		r22
#define	src_lh		r23
#define	src_hl		r24
#define	src_hh		r25


.global	LUT_reduce_asm
.type	LUT_reduce_asm, @function

LUT_reduce_asm : 
	
	mov		r30,			src_hh
	andi	r30,			0x0F
	mov		tmp_integer,	src_lh
	andi	tmp_integer,	0xF0
	eor		r30,			tmp_integer

	andi	src_lh,			0x0F
	ldi		r31,			hi8(LUT2_H)
	ld		tmp_h,			Z
	ldi		r31,			hi8(LUT2_L)
	ld		tmp_l,			Z
	add		src_ll,			tmp_l
	adc		src_lh,			tmp_h 
	
	mov		r30,			src_hl
	ldi		r31,			hi8(LUT1_H)
	ld		src_hh,			Z
	ldi		r31,			hi8(LUT1_L)
	ld		src_hl,			Z
	add		src_hl,			src_ll
	adc		src_hh,			src_lh

	ret

#undef	tmp_integer	
#undef	tmp_h		
#undef	tmp_l		
#undef	src_ll		
#undef	src_lh		
#undef	src_hl		
#undef	src_hh		

#define	tmp_l			r22
#define	tmp_h			r23
#define	src_l			r24
#define	src_h			r25

.global	csubq_asm
.type	csubq_asm, @function

csubq_asm : 

	movw	tmp_l,	src_l
	lsl		tmp_h
	sbc		tmp_h,	tmp_h
	mov		tmp_l,	tmp_h
	andi	tmp_l,	0x01
	andi	tmp_h,	0x0D
	add		src_l,	tmp_l
	adc		src_h,	tmp_h

	subi	src_l,	0x01
	sbci	src_h,	0x0D

	movw	tmp_l,	src_l
	lsl		tmp_h
	sbc		tmp_h,	tmp_h
	mov		tmp_l,	tmp_h
	andi	tmp_l,	0x01
	andi	tmp_h,	0x0D
	add		src_l,	tmp_l
	adc		src_h,	tmp_h

	ret

#undef	tmp_l
#undef	tmp_h
#undef	src_l
#undef	src_h
